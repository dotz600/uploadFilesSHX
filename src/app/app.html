<main class="main-container" dir="rtl">
  <!-- Top Bar with Token -->
  <div class="top-bar">
    <div class="token-container" [class.token-active]="isTokenSet">
      <div class="token-input-group" *ngIf="!isTokenSet">
        <input type="password" [(ngModel)]="token" placeholder="טוקן אבטחה..." class="compact-token-input">
        <button class="small-set-btn" (click)="setToken()">הגדר</button>
      </div>
      <div class="token-verified" *ngIf="isTokenSet" (click)="isTokenSet = false" title="ערוך טוקן">
        <span class="v-mark">✅</span>
      </div>
    </div>
    <h1 class="page-title-mini">לוח בקרה לשידור קבצים</h1>
  </div>

  <!-- Success Section -->
  <div class="success-section glass-card" *ngIf="isSuccess">
    <div class="success-icon">🎉</div>
    <h2>השידור הושלם בהצלחה!</h2>
    <p>הקבצים שלך הועברו למערכת בצורה תקינה.</p>
    <button class="send-btn" (click)="resetForm()">שידור קבצים נוספים</button>
  </div>

  <!-- Main Form -->
  <div class="form-container glass-card" *ngIf="!isSuccess">
    <div class="input-group">
      <label>מספר תיק</label>
      <input type="number" [(ngModel)]="caseNumber" placeholder="למשל: 123456" class="premium-input">
    </div>
    <div class="input-group">
      <label>תאריך התחלה</label>
      <input type="date" [(ngModel)]="startPeriod" class="premium-input">
    </div>
    <div class="input-group">
      <label>תאריך סיום</label>
      <input type="date" [(ngModel)]="endPeriod" class="premium-input">
    </div>
  </div>

  <div class="upload-grid" *ngIf="!isSuccess">
    <app-file-upload title="בחר קובץ INI" accept=".txt" (fileSelected)="onIniSelected($event)">
    </app-file-upload>

    <app-file-upload title="בחר קובץ BKMVDATA" accept=".txt" (fileSelected)="onBkmvdataSelected($event)">
    </app-file-upload>
  </div>

  <div class="actions" *ngIf="!isSuccess">
    <button class="send-btn" [disabled]="isUploading" (click)="sendFiles()">
      {{ isUploading ? 'משדר...' : 'שידור קבצים' }}
    </button>
  </div>

  <p *ngIf="uploadStatus" class="status-msg" [class.error-msg]="uploadStatus.includes('נכשל')">{{ uploadStatus }}</p>

  <!-- Loading Spinner Overlay -->
  <div class="spinner-overlay" *ngIf="isUploading">
    <div class="spinner-container">
      <div class="spinner"></div>
      <p class="spinner-text">מעלה קבצים...</p>
    </div>
  </div>

</main>